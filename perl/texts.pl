#!/usr/bin/perl -w
# Generate names and version ID of ourtext() variables
#
# Input: inc/ourtexts.inc   Output: inc/ourtext.h
#
use strict;
use FindBin qw($Bin);
use lib $Bin;
use CRC32;

print <<INTRO;
// This file is autogenerated. DO NOT EDIT.
// Edit perl/texts.pl instead.

INTRO

my ($ind,$vardatasize,$maxname,@textnames);
$ind = -1;
while (<>) {
	next unless /^\s*defourtext (\w+)/;
	
	my $name = $1;
	$ind++;

	$maxname = $ind if !$maxname || $ind>$maxname;
	print "#define TXT_$name $ind\n";
	$textnames[$ind] = $name;
}

my $version = sprintf "%x", crc32 "@textnames";

print <<"FOOTER";
#define TXT_VERSIONID 0x$version

#ifdef WANTINGAMETEXTNAMES
const char *ingametextnames[] = {
FOOTER

print qq(\t"$textnames[$_]",\t// $_\n) for 0..$#textnames;
print "};\n#endif\n";
